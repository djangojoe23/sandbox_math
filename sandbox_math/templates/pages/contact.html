{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block javascript %}
  {{ block.super }}
{% endblock javascript %}

{% block content %}
<!-- Page title + contact form-->
<section class="container pt-5 pb-lg-2 pb-xl-4 py-xxl-5 my-5">
  <div class="row pb-1 pb-sm-3 pb-lg-4 pt-3">
    <!-- Page title-->
    <div class="col-lg-4 pe-xxl-4">
      <h1 class="display-2">Contact</h1>
      <p class="fs-lg pb-4 mb-0 mb-sm-2">Send a message by completing the form below and someone will get back to you within a day or two!</p>
    </div>
    <div class="col-lg-8 col-xl-7 offset-xl-1">
      {% crispy form %}
    </div>
  </div>
</section>

{% endblock content %}

{% block inline_javascript %}
  <script src="https://www.google.com/recaptcha/api.js?render={{ recaptcha_key }}"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script>
    $('#id_captcha').val('') //Need this to clear the form field and get a new token
    grecaptcha.ready(function() {
      $('#contactForm').submit(function(e){
        let form = this;
        e.preventDefault()
        grecaptcha.execute('{{ recaptcha_key }}', {action: 'contactForm'}).then(function(token) {
          $('#id_captcha').val(token)
          form.submit()
        });
      })
    });
</script>
{% endblock inline_javascript %}
